<div class="scpi-container" *ngIf="!isLoading && scpi; else loadingOrError">
  <div class="button-container-top">
    <button type="button" class="back-btn-icon" (click)="goBack()">
      <i class="pi pi-arrow-left" aria-hidden="true"></i>
    </button>
  </div>

  <div class="scpi-header">
    <div class="scpi-info">
      <div class="scpi-icon" aria-hidden="true">
        <i class="pi pi-building"></i>
      </div>
      <div class="scpi-titles">
        <h2 class="scpi-title">{{ scpi.name }}</h2>
        <p class="scpi-manager">{{ scpi.manager }}</p>
      </div>
    </div>
  </div>

  <div *ngIf="scpi.advertising" class="info-banner">
    <i class="pi pi-info-circle" aria-hidden="true"></i>
    <p>{{ scpi.advertising }}</p>
  </div>

  <p-tabs value="0" class="mt-8">
    <p-tablist>
      <p-tab value="0">
        <div class="flex items-center gap-2">
          <i class="pi pi-chart-pie"></i>
          <span>Répartition</span>
        </div>
      </p-tab>

      <p-tab value="1">
        <div class="flex items-center gap-2">
          <i class="pi pi-chart-bar"></i>
          <span>Performance</span>
        </div>
      </p-tab>

      <p-tab value="2">
        <div class="flex items-center gap-2">
          <i class="pi pi-euro"></i>
          <span>Évolution</span>
        </div>
      </p-tab>

      <p-tab value="3">
        <div class="flex items-center gap-2">
          <i class="pi pi-info-circle"></i>
          <span>Indicateurs</span>
        </div>
      </p-tab>
    </p-tablist>

    <p-tabpanels>
      <p-tabpanel value="0">
        <div class="tab-content" *ngIf="scpi?.id">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-5 h-auto md:min-h-[550px]">
            <app-geo-repartition
              *ngIf="repartition"
              [geographicalData]="repartition.geographical"
              class="h-full">
            </app-geo-repartition>
            <app-sectoral-repartition
              *ngIf="repartition"
              [sectoralData]="repartition.sectoral"
              class="h-full">
            </app-sectoral-repartition>
          </div>
        </div>
      </p-tabpanel>

      <p-tabpanel value="1">
        <div class="tab-content" *ngIf="scpi?.id">
          <app-performance-history [scpiId]="scpi.id"></app-performance-history>
        </div>
      </p-tabpanel>

      <p-tabpanel value="2">
        <div class="tab-content">
          <app-scpi-valuation-timeline [scpi]="scpi"></app-scpi-valuation-timeline>
        </div>
      </p-tabpanel>

      <p-tabpanel value="3">
        <div class="tab-content">
          <div class="indicators-grid">
            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-briefcase"></i>
              </div>
              <div class="value">{{ scpi.manager }}</div>
              <div class="label">Gérant</div>
            </div>

            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-wallet"></i>
              </div>
              <div class="value">
                {{ scpi.capitalization | formatField : "millionCurrency" }}
              </div>
              <div class="label">Capitalisation</div>
            </div>

            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-tag"></i>
              </div>
              <div class="value">{{ scpi.sharePrice | formatField : "currency" }}</div>
              <div class="label">Prix par part</div>
            </div>

            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-dollar"></i>
              </div>
              <div class="value">
                {{ scpi.minimumSubscription | formatField : "currency" }}
              </div>
              <div class="label">Souscription minimum</div>
            </div>

            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-chart-line"></i>
              </div>
              <div class="value">
                {{ scpi.distributionRate | formatField : "percent" }}
              </div>
              <div class="label">Taux de distribution</div>
            </div>

            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-percentage"></i>
              </div>
              <div class="value">
                {{ scpi.subscriptionFees | formatField : "percent" }}
              </div>
              <div class="label">Frais de souscription</div>
            </div>

            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-cog"></i>
              </div>
              <div class="value">
                {{ scpi.managementFees | formatField : "percent" }}
              </div>
              <div class="label">Frais de gestion</div>
            </div>

            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-clock"></i>
              </div>
              <div class="value">{{ scpi.enjoymentDelay | formatField : "month" }}</div>
              <div class="label">Délai de jouissance</div>
            </div>

            <div class="indicator-card">
              <div class="icon-wrapper" aria-hidden="true">
                <i class="pi pi-calendar"></i>
              </div>
              <div class="value">{{ scpi.rentFrequency }}</div>
              <div class="label">Fréquence des loyers</div>
            </div>
          </div>
        </div>
      </p-tabpanel>
    </p-tabpanels>
  </p-tabs>
</div>

<ng-template #loadingOrError>
  <div class="status-container">
    <p *ngIf="isLoading" class="loading">Chargement des détails...</p>
    <p *ngIf="error" class="error">{{ error }}</p>
  </div>
</ng-template>

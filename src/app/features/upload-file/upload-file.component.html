<div class="kyc-container">
  <ng-container *ngIf="!allUploaded; else uploadedMessage">
    <div class="kyc-wrapper">
      <ng-container *ngFor="let doc of documents">
        <p-card
          class="kyc-card"
          [ngClass]="{ 'kyc-card--address': doc.key === 'address' }"
        >
          <ng-template pTemplate="header">
            <div class="kyc-title">{{ doc.label }}</div>
            <div class="kyc-subtitle">
              <ng-container [ngSwitch]="doc.key">
                <span *ngSwitchCase="'identity'"
                  >Carte d'identité, passeport ou titre de séjour</span
                >
                <span *ngSwitchCase="'address'"
                  >Facture d'électricité, de gaz, d'eau ou quittance de loyer
                  (moins de 3 mois)</span
                >
                <span *ngSwitchCase="'tax'"
                  >Dernier avis d'imposition sur le revenu</span
                >
              </ng-container>
            </div>
          </ng-template>

          <p-fileUpload
            #fileUploadRef
            [name]="doc.key"
            mode="advanced"
            [multiple]="true"
            [showUploadButton]="false"
            [showCancelButton]="false"
            [customUpload]="true"
            (onSelect)="onSelect($event, doc.key)"
            (onClear)="onClear(doc.key)"
            [maxFileSize]="maxFileSize"
            [accept]="accept"
            chooseLabel="Parcourir les fichiers"
            class="kyc-uploader"
          >
            <ng-template pTemplate="content">
              <div class="dropzone" *ngIf="!files[doc.key]?.length">
                <div class="dropzone-icon"><i class="pi pi-upload"></i></div>
                <div class="dropzone-text">Glissez-déposez vos documents</div>
                <span class="dropzone-ou">ou</span>
                <button
                  type="button"
                  pButton
                  class="p-button-outlined kyc-choose-btn"
                  label="Parcourir les fichiers"
                  (click)="triggerChoose($event, doc.key)"
                ></button>
                <div class="dropzone-hint">PDF, JPG, PNG · Max 10 Mo</div>
              </div>

              <div *ngIf="files[doc.key]?.length" class="file-list">
                <div *ngFor="let file of files[doc.key]" class="file-chip">
                  <i
                    class="pi"
                    [ngClass]="
                      file.type === 'application/pdf'
                        ? 'pi-file-pdf'
                        : 'pi-image'
                    "
                  ></i>
                  <span class="file-name" [title]="file.name">{{
                    file.name
                  }}</span>
                  <div class="file-chip-actions">
                    <button
                      type="button"
                      pButton
                      class="p-button-text p-button-sm preview-btn"
                      icon="pi pi-eye"
                      (click)="previewFile(doc.key, file)"
                    ></button>
                    <button
                      type="button"
                      pButton
                      class="p-button-text p-button-sm remove-btn"
                      icon="pi pi-times"
                      (click)="removeFile(doc.key, file)"
                    ></button>
                  </div>
                </div>
              </div>
            </ng-template>
          </p-fileUpload>
        </p-card>
      </ng-container>
    </div>

    <div class="kyc-actions">
      <button
        pButton
        label="Enregistrer"
        icon="pi pi-check"
        (click)="save()"
        [disabled]="!canSave()"
        class="p-button-success kyc-save-btn"
      ></button>
    </div>
  </ng-container>

  <ng-template #uploadedMessage>
    <p-card class="kyc-card kyc-card--confirmation">
      <div class="confirmation-icon">
        <i
          class="pi pi-check-circle"
          style="font-size: 3rem; color: #28a745"
        ></i>
      </div>
      <h2>Merci !</h2>
      <p>
        Vos documents ont été envoyés avec succès pour vérification. Notre
        équipe les analysera dans les plus brefs délais et vous recevrez une
        confirmation dès que possible.
      </p>
    </p-card>
  </ng-template>
</div>
